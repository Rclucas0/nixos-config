#+title: NixOS Flake Configuration
#+author: Riley Lucas
#+description: What NixOS is and my configuration


* TABLE OF CONTENTS :toc@4:
- [[#what-is-nixos][What Is NixOS]]
- [[#useful-nix-commands][Useful Nix Commands]]
- [[#what-are-nix-flakes][What Are Nix Flakes]]
- [[#my-current-nixos-configuration-using-nix-flakes][My Current NixOS Configuration Using Nix Flakes]]
- [[#flakenix-configuration][Flake.nix Configuration]]
- [[#link-to-configurationnix-files][Link To Configuration.nix Files]]
- [[#link-to-dwm-configuration-files][Link To Dwm Configuration Files]]
- [[#user-dotfiles][User Dotfiles]]
  - [[#homenix-configuration][Home.nix Configuration]]
    - [[#starshipnix][Starship.nix]]
    - [[#sxhkd-config][Sxhkd Config]]
    - [[#bash-config][Bash Config]]

* What Is NixOS

- NixOS is a declarative system unlike most systems that you normally see to day which are imperative
- Only difference is that the system configurations other then user customization is all done in one file and is rebuilt on each install
- The configuration is written in a functional programming language called Nix
- The Nix programming uses nix to create and nix package which is then used to

* Useful Nix Commands

- sudo nixos-rebuild switch/test
  * This command will reinstall the entire system and add a new entry to boot loader if used switch, test will do the same other than adding it to boot loader

- sudo nixos-rebuild switch/ test --flake ./path/to/flake.nix
  * Rebuilds the system with a flake rather than default configuration.nixos

- sudo nix-collect-garbage --delete-older-than 15d
  * Will remove unused packages and boot loader entries

* What Are Nix Flakes

From [[https://zero-to-nix.com/concepts/flakes][Zero to Nix]]

- A Nix flake is a directory with a flake.nix and flake.lock at the root that outputs Nix expressions that others can use to do things like build packages, run programs, use development environments, or stand up NixOS systems. If necessary, flakes can use the outputs of other flakes as inputs.

* My Current NixOS Configuration Using Nix Flakes

- This is my current set up of NixOS using a flake to setup the main system
- I am also using emacs org-mode to set up most of this config and what you are reading now

[[./1mon-gruvbox-dwm.png]]

* Flake.nix Configuration


#+begin_src nix :tangle ./flake.nix

{
  description = "ZaneyOS";

  inputs = {
    nixpkgs.url = "github:nixos/nixpkgs/nixos-unstable";
    home-manager.url = "github:nix-community/home-manager/master";
    home-manager.inputs.nixpkgs.follows = "nixpkgs";
  };
  outputs = inputs@{ nixpkgs, home-manager, ... }:
  let
    system = "x86_64-linux";

    # User Variables
    hostname = "nixos";
    username = "rileyl";
    gitUsername = "Riley Lucas";
    gitEmail = "rclucas0@gmail.com";

    pkgs = import nixpkgs {
      inherit system;
      config = {
	    allowUnfree = true;
      };
    };
  in {
    nixosConfigurations = {
      "${hostname}" = nixpkgs.lib.nixosSystem {
	    specialArgs = {
          inherit system; inherit inputs;
          inherit username; inherit hostname;
          inherit gitUsername; inherit gitEmail;
        };
	    modules = [ ./profiles/personal-dwm/configuration.nix
          home-manager.nixosModules.home-manager {
	        home-manager.extraSpecialArgs = {
              inherit username; inherit gitEmail;
              inherit inputs; inherit gitUsername;
            };
	        home-manager.useGlobalPkgs = true;
            home-manager.useUserPackages = true;
            home-manager.backupFileExtension = "backup";
	        home-manager.users.${username} = import ./home.nix;
	      }
	    ];
      };
    };
  };
}


#+end_src



#+begin_src nix ./flake.nix
{
  description = "My Nix Flake Configuration With Dwm";

  inputs = {
    nixpkgs.url = "github:nixos/nixpkgs/nixos-23.11";
    home-manager.url = "github:nix-community/home-manager/release-23.11";
    home-manager.inputs.nixpkgs.follows = "nixpkgs";
  };

  outputs = { self, nixpkgs, home-manager, ... }:
  let
    lib = nixpkgs.lib;
    system = "x86_64-linux";
    pkgs = nixpkgs.legacyPackages.${system};

  in {
    nixosConfigurations = {
      nixos = lib.nixosSystem {
        inherit system;
        modules = [ ./profiles/personal-dwm/configuration.nix
                home-manager.extraSpecialArgs = { inherit inputs; };
	        home-manager.useGlobalPkgs = true;
            home-manager.useUserPackages = true;
            home-manager.backupFileExtension = "backup";
	        home-manager.users.rileyl = import ./home.nix;
	      }

       ];
      };
    };

#    homeConfigurations = {
#      rileyl = home-manager.lib.homeManagerConfiguration {
#        inherit pkgs;
#        modules = [ ./home.nix ];
#      };
#    };
  };
}
#+end_src

* Link To Configuration.nix [[./system/README.org][Files]]
* Link To Dwm Configuration [[./user/wm/README.org][Files]]
* User Dotfiles

- These are the files that are not controlled by the flake or by the base NixOS config
- Soon will be moved to a home-manager setup

** Home.nix Configuration

#+begin_src nix :tangle ./home.nix
{ config, pkgs, inputs, gitEmail, gitUsername, username, ... }:

{
  # Home Manager needs a bit of information about you and the paths it should
  # manage.
  home.username = "${username}";
  home.homeDirectory = "/home/${username}";
  home.stateVersion = "23.11"; # Please read the comment before changing.

  imports = [
    ./user/starship.nix

    ];

  # Install & Configure Git
  programs.git = {
    enable = true;
    userName = "${gitUsername}";
    userEmail = "${gitEmail}";
  };



  # The home.packages option allows you to install Nix packages into your
  # environment.
  home.packages = [
    # # Adds the 'hello' command to your environment. It prints a friendly
    # # "Hello, world!" when run.
    # pkgs.hello

    # # It is sometimes useful to fine-tune packages, for example, by applying
    # # overrides. You can do that directly here, just don't forget the
    # # parentheses. Maybe you want to install Nerd Fonts with a limited number of
    # # fonts?
    # (pkgs.nerdfonts.override { fonts = [ "FantasqueSansMono" ]; })

    # # You can also create simple shell scripts directly inside your
    # # configuration. For example, this adds a command 'my-hello' to your
    # # environment:
    # (pkgs.writeShellScriptBin "my-hello" ''
    #   echo "Hello, ${config.home.username}!"
    # '')
  ];

  # Home Manager is pretty good at managing dotfiles. The primary way to manage
  # plain files is through 'home.file'.
  home.file = {
    # # Building this configuration will create a copy of 'dotfiles/screenrc' in
    # # the Nix store. Activating the configuration will then make '~/.screenrc' a
    # # symlink to the Nix store copy.
    # ".screenrc".source = dotfiles/screenrc;

    # # You can also set the file content immediately.
    # ".gradle/gradle.properties".text = ''
    #   org.gradle.console=verbose
    #   org.gradle.daemon.idletimeout=3600000
    # '';
  };

  # Home Manager can also manage your environment variables through
  # 'home.sessionVariables'. If you don't want to manage your shell through Home
  # Manager then you have to manually source 'hm-session-vars.sh' located at
  # either
  #
  #  ~/.nix-profile/etc/profile.d/hm-session-vars.sh
  #
  # or
  #
  #  ~/.local/state/nix/profiles/profile/etc/profile.d/hm-session-vars.sh
  #
  # or
  #
  #  /etc/profiles/per-user/rileyl/etc/profile.d/hm-session-vars.sh
  #
  home.sessionVariables = {
    # EDITOR = "emacs";
  };

  # Let Home Manager install and manage itself.
  programs.home-manager.enable = true;
}

#+end_src

*** Starship.nix

#+begin_src nix :tangle ./user/starship.nix
{ config, pkgs, ... }:

{
  programs.starship = {
    enable = true;
    settings = {
      aws.style = "bold #ffb86c";
      cmd_duration.style = "bold #f1fa8c";
      directory.style = "bold #50fa7b";
      hostname.style = "bold #ff5555";
      git_branch.style = "bold #ff79c6";
      git_status.style = "bold #ff5555";
      username = {
        format = "[$user]($style) on ";
        style_user = "bold #bd93f9";
      };
      character = {
        success_symbol = "[](bold #f8f8f2)";
        error_symbol = "[](bold #ff5555)";
      };
    };
  };
}

#+end_src

*** Sxhkd Config

#+begin_src bash :tangle ~/.config/sxhkd/sxhkdrc
super + BackSpace
	pkill -USR1 -x sxhkd

super + {_}{w,a,Return,e}
	{brave,st,kitty,emacsclient -c -a 'emacs'}

super + shift + {_}{d}
	{rofi -show drun}

alt + {_}{d,s,r,h,m,g}
	{discord,steam,dmenu_run,flatpak run com.heroicgameslauncher.hgl,prismlauncher,gimp}

alt + shift + {_}{p,Return}
	{pavucontrol,thunar}

ctrl + {_}{p}
	{flameshot gui}
#+end_src

*** Bash Config

#+begin_src nix ./

#+end_src
